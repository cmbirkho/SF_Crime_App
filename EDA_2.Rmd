---
title: "EDA_2"
author: "Connor Birkhold"
date: "1/25/2020"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.width = 8, fig.height = 5)
```

```{r include=FALSE}
rm(list = ls())

library(data.table)
library(tidyverse)
library(lubridate)
library(RSQLite)
library(DBI)
library(caret)
```


```{r}
dbPath <- "C:/Users/Cbirkho/Documents/SF_Crime_App/SF_Application/sf_crime_db.sqlite"

db <- dbConnect(SQLite(), dbname = dbPath)

df <- dbGetQuery(db,  "SELECT 
                          ir.*
                          ,ml.min_to_nxt_incident
                          ,ml.ft_to_nxt_incident
                          ,ml.min_bw_report
                       FROM incident_reports ir
                       JOIN ml_data_incidents ml
                       ON ir.incident_id_nbr_cd = ml.incident_id_nbr_cd;")

dbDisconnect(db)

setDT(df)

```


```{r}
# Convert the character columns to factors
convStr <- function(x){
  for(i in length(x)){
    catVar <- select_if(x, is.character)
    catVar <- lapply(catVar, as.factor)
    catVar <- as.data.frame(catVar)
    
    numVar <- select_if(x, is.numeric)
    numVar <- lapply(numVar, as.numeric)
    numVar <- as.data.frame(numVar)
    
    final <- cbind(catVar, numVar)
    return(final)
  }
}

df <- convStr(df)
```

```{r}
setDT(df)

df <- df[!is.na(incident_value), ]

```


```{r}
set.seed(54321)
indexes <- createDataPartition(df$incident_value,
                               times = 1,
                               p = 0.7,
                               list = FALSE)

training <- df[indexes,]
testing <- df[- indexes,]
```

```{r}
train.control <- trainControl(method = "repeatedcv",
                              number = 10,
                              repeats = 3,
                              search = "grid")

caret.cv <- train(incident_value ~ incident_category ,
                  data = training,
                  method = "rf",
                  trControl = train.control)
```


