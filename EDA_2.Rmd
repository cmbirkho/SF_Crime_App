---
title: "EDA_2"
author: "Connor Birkhold"
date: "1/25/2020"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.width = 8, fig.height = 5)
```

```{r include=FALSE}
rm(list = ls())

library(data.table)
library(tidyverse)
library(lubridate)
library(RSQLite)
library(DBI)
library(tm)
library(tidytext)
library(wordcloud2)
library(RColorBrewer)
```


```{r}
dbPath <- "C:/Users/Cbirkho/Documents/SF_Crime_App/SF_Application/sf_crime_db.sqlite"

db <- dbConnect(SQLite(), dbname = dbPath)

df <- dbGetQuery(db,  "SELECT 
                          incident_id_nbr_cd
                          ,incident_description
                       FROM incident_reports;;")

dbDisconnect(db)

setDT(df)

```

#### Text Cleaning
```{r}
# extract only letters
df$incident_description <- gsub("[^a-zA-Z]", " ", df$incident_description)

# trim whitespace
df$incident_description <- str_trim(df$incident_description, side = 'both')
df$incident_description <- str_squish(df$incident_description)

#
df$incident_description <- removeWords(df$incident_description, tm::stopwords("english"))

```


#### Tokenize
```{r}
wordBag <- df %>%
  select(incident_description) %>%
  unnest_tokens(word, incident_description, token = 'words') %>%
  count(word, sort = TRUE)

```

```{r}
'%ni%' <- Negate("%in%")
wordBag <- subset(wordBag, wordBag$word %ni% c('from',
                                               'other',
                                               'W'))
```


#### 
```{r}

wordcloud(words = wordBag$word, freq = wordBag$n, 
          min.freq = 1,
          max.words = 200,
          random.order = FALSE,
          rot.per = 0.5,
          colors = brewer.pal(8, "Dark2"))


wordcloud2(wordBag, size = 1.6)


```






